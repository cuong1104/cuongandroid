package com.cuong.lib_nvc_android.view;import android.app.Activity;import android.content.Context;import android.graphics.PixelFormat;import android.os.Handler;import android.util.Log;import android.view.Gravity;import android.view.View;import android.view.WindowManager;import android.view.animation.Animation;import android.view.animation.AnimationUtils;import com.cuong.lib_nvc_android.R;/** * Created by unmer_000 on 26/06/2015. */public class CustomDialog {    private Activity activity;    private Context context;    private boolean isShowing = false;    protected View layoutDialog;    private WindowManager windowManager;    private Runnable onCancel;    private int idClose;    private int idContent;    private WindowManager.LayoutParams params;    private boolean cancelable = false;    public void setCancelable(boolean cancelable) {        this.cancelable = cancelable;    }    public CustomDialog(Activity activity) {        this.activity = activity;    }    public CustomDialog(Context context) {        this.context = context;    }    /**     * @layoutDialog This is a view to show dialog, should be fullscreen     * @idClose every dialog view should be have a View to close dialog     */    public void showPopup(final View layoutDialog, final int idClose, final int idContent) {        this.layoutDialog = layoutDialog;        this.idClose = idClose;        this.idContent = idContent;        initDialog();        show();    }    /**     * Init dialog but not show     */    public void initDialog(final View layoutDialog, final int idClose, final int idContent) {        this.layoutDialog = layoutDialog;        this.idClose = idClose;        this.idContent = idContent;        initDialog();        this.context = layoutDialog.getContext();    }    /**     * Init dialog and show it     */    private void initDialog() {        if (!isShowing) {            // Inflate the popup_layout.xml            if (activity != null) {                windowManager = (WindowManager) activity.getSystemService(activity.WINDOW_SERVICE);            } else if (context != null) {                windowManager = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);            } else {                Log.d("CustomDialog", "You need create custom dialog with a Context or Activity");                return;            }            params = new WindowManager.LayoutParams(                    WindowManager.LayoutParams.MATCH_PARENT,                    WindowManager.LayoutParams.MATCH_PARENT,                    WindowManager.LayoutParams.TYPE_PHONE,                    WindowManager.LayoutParams.FLAG_TURN_SCREEN_ON,                    PixelFormat.TRANSPARENT);            params.softInputMode = WindowManager.LayoutParams.SOFT_INPUT_ADJUST_PAN;            params.gravity = Gravity.CENTER;            params.x = 0;            params.y = 0;            setupOnCancel(idClose);        }    }    /**     * After dialog has been init, we can show dialog by this function     */    public void show() {        isShowing = true;        if (windowManager != null && params != null && layoutDialog != null) {            layoutDialog.setClickable(true);            windowManager.addView(layoutDialog, params);        } else {            Log.d("CustomDialog", "Can not show dialog");        }    }    private void setupOnCancel(int idClose) {        View vClose = layoutDialog.findViewById(idClose);        View vContent = layoutDialog.findViewById(idContent);        if (vClose != null) {            vClose.setOnClickListener(new View.OnClickListener() {                @Override                public void onClick(View v) {                    dismiss();                    isShowing = false;                }            });        } else {            Log.e("CustomDialog", "(Close view) Cannot finViewById with id " + idClose);        }        if (vContent != null) {            vContent.setOnClickListener(null);        }        layoutDialog.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                if (cancelable) {                    dismiss();                }            }        });    }    /**     * @runnable when user click to dismiss dialog, this runnable will be run     */    public void setOnCancel(Runnable runnable) {        this.onCancel = runnable;    }    public void dismiss() {        if (windowManager != null & layoutDialog != null && isShowing) {            try {                windowManager.removeView(layoutDialog);            } catch (Exception e) {                e.printStackTrace();            }            isShowing = false;        } else {            Log.d("CustomDialog", "Dialog cannot dismiss, please check and sure it showing");        }        if (onCancel != null) {            onCancel.run();        }    }    public boolean isShowing() {        return isShowing;    }    public Context getContext() {        return context;    }}